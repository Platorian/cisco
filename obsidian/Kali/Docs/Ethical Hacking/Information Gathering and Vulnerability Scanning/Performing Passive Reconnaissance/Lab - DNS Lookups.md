**Protego Security Solutions Task**

We need to learn about Pixel Paradise’s attack surface. One way to do this is to find all of the domains and subdomains that belong to Pixel Paradise that are registered in the DNS. Each subdomain can then be investigated further for vulnerabilities and exposures to attacks. 

Practice your skills with DNS investigation tools before we start our reconnaissance of Pixel Paradise.

In this lab, you will explore common tools used to gather information about a target through the Domain Name System (DNS). 

- Use **nslookup** to obtain domain and IP address information. 
- Use the **whois** command to find additional registration information. 
- Compare the Output of the Nslookup and Dig tools. 
- Perform Reverse DNS Lookups.

### Step 2: Investigating nslookup capabilities

Nslookup is a command line tool that is available in Linux and Windows. Its basic usage is to convert a domain name to an IP address. Nslookup has other functionality that can provide additional information.

1. Access the manual pages for **nslookup** using the **man** command:

┌──(kali㉿Kali)-[~]

└─$ **man nslookup**

2. To review the manual pages, press the **spacebar** to advance the pages. When you are finished reviewing the manual pages, press **q** to quit and return to the command line.

Which **set** keyword would you use to query for the mail server mx record within a domain?

set querytype=mx or set type=mx

### Step 3: Using the nslookup command

1. Use the **nslookup** command with no options to enter interactive mode. To exit interactive mode at any time, type **exit** to return to the CLI prompt.
2. The CLI prompt changes to > to indicate that you are now in interactive mode and can enter the various nslookup commands. Enter the domain name **cisco.com** to resolve the domain name to an IP address. By default, the **nslookup** command queries A and AAAA records for the target.

> **cisco.com**

The output of the command will be similar to that shown. The A record contains the IPv4 address assigned to the root domain and the AAAA record contains the IPv6 address.

```
┌──(kali㉿Kali)-[~]

└─$ nslookup

> cisco.com

Server:         192.168.1.1

Address:        192.168.1.1#53

Non-authoritative answer:

Name:   cisco.com

Address: 72.163.4.185

Name:   cisco.com

Address: 2001:420:1101:1::185
```

3. To find the domain name servers configured for cisco.com, use the **set type** command to change the query type to “ns” to return the name server information.

```
set type=ns
cisco.com
```

The output of the command should be similar to that shown below. The servers are listed by fully qualified domain name and are further listed as authoritative servers for both IPv4 and IPv6 addresses.

![[Pasted image 20240621084749.png]]

What are the IPv4 and IPv6 addresses of the primary DNS server (ns1)?

The IPv4 address is 72.163.5.201 and the IPv6 address is 2001:420:1101:6::a

### Step 4: Change the server used to perform lookups.

Occasionally it is desirable to use a different DNS server to perform lookups. This may be necessary if the local DNS server is unable to resolve an address or resolves the host name to an internal private address and you need to obtain the internet accessible address of the host.

1. In this query, use the one-line **nslookup** command syntax to change the server to look up skillsforall.com. The syntax for the command is **nslookup [hostname] [server IP].**

```
┌──(kali㉿Kali)-[~]

└─$ **nslookup skillsforall.com 8.8.8.8**
```

In interactive mode, you change the server using the **server** keyword.

┌──(kali㉿Kali)-[~]

```
└─$ **nslookup**

> **server 8.8.8.8**

> **skillsforall.com**
```

2. The **_any_** query type can retrieve much, or all, of the information contained in the DNS record for a host name. Often **_text_** records that can provide additional details about the domain are contained in DNS records. Using the 8.8.8.8 Google DNS server, find the DNS records for skillsforall.com.

```
┌──(kali㉿Kali)-[~]

└─$ **nslookup**

> **server 8.8.8.8**

> **set type=any**

> **skillsforall.com**

The output should look similar to this example:

┌──(kali㉿Kali)-[~]

└─$ **nslookup**

> **server 8.8.8.8**

Default server: 8.8.8.8

Address: 8.8.8.8#53

> **set type=any**

> **skillsforall.com**

;; Connection to 8.8.8.8#53(8.8.8.8) for skillsforall.com failed: timed out.

Server:         8.8.8.8

Address:        8.8.8.8#53

Non-authoritative answer:

Name:   skillsforall.com

Address: 13.225.142.127

Name:   skillsforall.com

Address: 13.225.142.7

Name:   skillsforall.com

Address: 13.225.142.73

Name:   skillsforall.com

Address: 13.225.142.9

skillsforall.com        nameserver = ns-1130.awsdns-13.org.

skillsforall.com        nameserver = ns-1652.awsdns-14.co.uk.

skillsforall.com        nameserver = ns-489.awsdns-61.com.

skillsforall.com        nameserver = ns-588.awsdns-09.net.

skillsforall.com

        origin = ns-1130.awsdns-13.org

        mail addr = awsdns-hostmaster.amazon.com

        serial = 1

        refresh = 7200

        retry = 900

        expire = 1209600

        minimum = 86400

skillsforall.com        mail exchanger = 10 inbound-smtp.us-east-1.amazonaws.com.

skillsforall.com        text = "d1g1l9y74sxj8m.cloudfront.net"

skillsforall.com        text = "facebook-domain-verification=8cg08gu4eikp0d2d1quqhjwh5ti1vv"

skillsforall.com        text = "google-site-

verification=Q5NIWRygJYTSLxuHReNKw1kvgC8IXKTOyPf5zITDv40"

skillsforall.com        text =

"identrust_validate=tadDBgWwQAKpw6QCCQDCagqsZgxHELybnPOCQHNU+rsV"
```

What record types are displayed in the output of the nslookup command with the type set to any?

All permitted record types, including A, AAAA, ns, mx, and text.

### Part 2: Use the Whois function to obtain domain information

The whois tool queries domain registration information, rather than the DNS server records. It is another form of passive reconnaissance that can identify where the domain is registered, technical and administrative contact information, and physical locations. Be aware that information contained in domain registrations can be set to private and often the contact information is that of the hosting service, rather than the organization itself.


### Step 1: Compare whois output for various organizations.

1. The whois tool is available from the CLI prompt ion Kali Linux. Use the **whois** command to obtain information about cisco.com.

```
┌──(kali㉿Kali)-[~]

└─$ whois cisco.com
```

2. Now use the **whois** command to obtain information about the skillsforall.com domain.

What conclusion can you make about the two domains (cisco.com and skillsforall.com) based on the output of the **whois** commands?

Both domains are owned by Cisco and hosted in the cloud.

### Step 2: Use whois to determine IP address registration information.

The whois tool can also be used to gather information about IP address ranges that are assigned to an organization. In the previous part of this lab, we discovered the IP addresses assigned to various domain DNS server host names. Now you can use that address information to obtain additional details about the external IP address ranges that are assigned to those organizations.

1. Review the output you obtained from using **nslookup** to obtain the DNS server IP addresses for cisco.com. Record the IP addresses of the Cisco DNS servers.
2. Use the Whois tool to find what IP address ranges are assigned to Cisco and are used on the networks hosting their DNS servers. At the time of this lab, ns1.cisco.com resolved to the IP address 72.163.5.201, however this may vary. At the prompt, enter **whois 72.163.5.201**.

![[Pasted image 20240621085106.png]]


## Part 3: Compare the Output of the Nslookup and Dig Functions

**Step 1: Use Linux Dig to Query for DNS servers.**

1. Dig is a Linux function that performs DNS queries. The format of a Dig query is similar to that of Nslookup. To resolve the hostname cisco.com to an IP address, use the syntax **dig** [hostname].

┌──(kali㉿Kali)-[~]

└─$ **dig cisco.com**


2. o obtain the IPv6 address of cisco.com it is necessary to add a type to the command structure. The syntax to instruct Dig to query a specific record type is dig **_[_hostname_]_ _[_record type_]_**.

┌──(kali㉿Kali)-[~]

└─$ **dig cisco.com AAAA**

**Step 2: Use Dig to Obtain Additional Information.**

1. In the earlier part of this lab, nslookup was used to obtain the DNS servers for cisco.com. Use the 8.8.8.8 Google DNS server to query for the DNS server records. The syntax to use a dig command to perform a query using a different DNS server is **dig** **[_hostname_] @[_DNS server IP_] [_type_]**. At the prompt, enter **dig cisco.com 8.8.8.8 ns**.

┌──(kali㉿Kali)-[~]

└─$ **dig cisco.com 8.8.8.8 ns**

### Part 4: Perform Reverse DNS Lookups

**Step 1: Use Dig to Perform rDNS Lookups**

Now that you can perform DNS lookups and use Whois to determine IP address ranges, use Dig to find additional host names. Reverse DNS (rDNS) lookups use the IP address to query for the host names of the services that resolve to that address.

1. Enter the **dig** command using the -x option to retrieve the hostname and record type of the ns1.cisco.com DNS server (**72.163.5.201)**.

┌──(kali㉿Kali)-[~]

└─$ **dig -x 72.163.5.201**

2. Use the **dig -x** command to query for another IP address in the same subnet.

┌──(kali㉿Kali)-[~]

└─$ **dig -x 72.163.1.1**

**Step 2: Use the Host Utility to Perform rDNS Lookups**

The Host utility is a function in Linux that performs lookups to convert IP addresses to host names. Use this utility to find another host on the 72.163.0.0/16 network.

1. The syntax of the **host** command is **host** [_ip address or hostname_]
    
    ┌──(kali㉿Kali)-[~]
    
    └─$ **host 72.163.10.1**
    
2. Host can also be used to perform a quick IP address lookup for a known hostname.
    
    ┌──(kali㉿Kali)-[~]
    
    └─$ **host hsrp-72-163-10-1.cisco.com**

3. URLs often contain aliases for the host name of the server hosting the website. The output of the host command can list the servers that respond to that URL.

┌──(kali㉿Kali)-[~]

└─$ **host hsrp-72-163-10-1.cisco.com**

The information about aliases is useful when trying to determine where the actual website or service is located.

### Step 3: Use nslookup to Perform rDNS Lookups

Nslookup is used primarily to perform IP address lookups for known host names. It can also be used to perform rDNS lookups to return a host name assigned to a known IP address.

Use Nslookup to find hostnames associated with an IP address.

In non-interactive mode the syntax to do an rDNS query is nslookup [ip address].

┌──(kali㉿Kali)-[~]

└─$ **nslookup 72.163.5.201**

To use interactive mode, enter **nslookup** with no options. At the **>** prompt, enter the target IP address.

┌──(kali㉿Kali)-[~]

└─$ **nslookup**

> **72.163.5.201**

