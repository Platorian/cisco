Module 3, “Information Gathering and Vulnerability Identification,” covers some of the methodologies and tools that can be used for active and passive reconnaissance. The following sections discuss several additional tools that can be used for reconnaissance and enumeration.

#### Tools for Passive Reconnaissance

Passive reconnaissance involves attempting to gather information about a victim by using public information and records but not using any active tools like scanners or sending any packets to the victim. The industry often refers to publicly available information as open-source intelligence (OSINT).

**NOTE** OSINT often includes threat intelligence, and it can be used for both offensive and defensive security. In this section, when we talk about OSINT, we are talking about using it for offensive security (that is, penetration testing and ethical hacking).

The following sections describe some of the most popular passive reconnaissance and OSINT tools.

---

**Nslookup, Host, and Dig**

You can use DNS-based tools like **_Nslookup_**, Host, and Dig to perform passive reconnaissance. Example 10-1 shows Nslookup output for store.h4cker.org. This domain is a canonical name (CNAME) that is associated with pentestplus.github.io. The website is hosted on GitHub, and there are a few IP addresses that resolve to that name (185.199.108.153, 185.199.109.153, 185.199.110.153, and 185.199.111.153).

**_Example 10-1_** _-_ _Using Nslookup for Passive Reconnaissance_

```
omar@kali:~$ nslookup store.h4cker.org
Server:           172.18.108.34
Address:          172.18.108.34#53
```

Example 10-2 shows the output of the Dig utility against the same website.

**_Example 10-2_** _-_ _Using Dig for Passive Reconnaissance_

```
omar@poseidon:~$ dig store.h4cker.org

ANSWER SECTION:store.h4cker.org.           3600 IN   CNAME    pentestplus.github. io.
pentestplus.github.io.      3599 IN   CNAME    sni.github.map.                                                    fastly.net.
sni.github.map.fastly.net.  3599 IN   A        185.199.111.153
sni.github.map.fastly.net.  3599 IN   A        185.199.110.153
sni.github.map.fastly.net.  3599 IN   A        185.199.109.153
sni.github.map.fastly.net.  3599 IN   A        185.199.108.153

```

---

**Whois**

The Internet Corporation for Assigned Names and Numbers (ICANN) is the organization that supervises the Internet’s domains and that created the **_Whois_** Data Problem Reporting System (WDPRS). Most Linux, Windows, and macOS versions support the Whois utility for querying the Whois database. You can also use Whois for reconnaissance. Unfortunately, because of the European Union’s General Data Protection Regulation (GDPR), the Whois database has been restricted to protect privacy. Example 10-3 shows the output of the Whois utility when querying the h4cker.org domain.

**_Example 10-3_** _-_ _Using Whois for Passive Reconnaissance_

```
omar@kali:~$ whois h4cker.org
Domain Name: H4CKER.ORG
Registry Domain ID: D402200000006011258-LROR
Registrar WHOIS Server: whois.google.com
Registrar URL: http://domains.google.com
```

---

**FOCA**

**_Fingerprinting Organization with Collected Archives (FOCA)_** is a tool designed to find metadata and hidden information in documents. FOCA can analyze websites as well as Microsoft Office, Open Office, PDF, and other documents. You can download FOCA from _[https://github.com/ElevenPaths/FOCA](https://github.com/ElevenPaths/FOCA)_. FOCA analyzes files by extracting **_EXIF_** (exchangeable image file format) information from graphics files, as well as information discovered through the URL of a scanned website.

---

**ExifTool**

ExifTool is a popular tool for extracting EXIF information from images. EXIF is a standard that defines the formats for images, sound, and ancillary tags used by digital equipment such as digital cameras, mobile phones, and tablets. You can download ExifTool from _[https://exiftool.org](https://exiftool.org)_. Example 10-4 shows output from ExifTool when it is run against an image called omar_pic.jpg.

**_Example 10-4_** _-_ _Using ExifTool_

```
omar@kali:~$ exif omar_pic.jpg
EXIF tags in ' omar_pic.jpg' ('Motorola' byte order):
---------------------+------------------------------------------------
Tag                       |Value
---------------------+------------------------------------------------
Manufacturer            |Apple
Model                   |iPhone X
Orientation             |Top-left
X-Resolution            |72
Y-Resolution            |72
```

---

**theHarvester**

**_theHarvester_** is a tool that can be used to enumerate DNS information about a given hostname or IP address. It can query several data sources, including Baidu, Google, LinkedIn, public Pretty Good Privacy (PGP) servers, Twitter, vhost, Virus Total, ThreatCrowd, CRT.SH, Netcraft, and Yahoo. Example 10-5 shows the different options of the theHarvester tool.

**_Example 10-5_** _-_ _theHarvester Tool Options_

```
omar@kali:~$ theHarvester -h
Usage: theharvester options           

-d: Domain to search or company name           
-b: data source: baidu, bing, bingapi, dogpile, google,
googleCSE, googleplus, google-profiles, linkedin, pgp, twitter,vhost,virustotal, threatcrowd, crtsh, netcraft, yahoo, all
```

Example 10-6 shows the theHarvester tool being used to gather information about the domain h4cker.org, using all data sources (-b all). You can see that the theHarvester tool found several subdomains: backdoor.h4cker.org, mail.h4cker.org, malicious.h4cker.org, portal.h4cker.org, store.h4cker.org, and web.h4cker.org.

**_Example 10-6_** _-_ _Using the theHarvester Tool to Gather Information About h4cker.org_

**NOTE** The command theharverster is deprecated. Please use theHarverster instead. The output will be slightly different than shown in Example 10-6.

---

**Shodan**

**_Shodan_** is a search engine for devices connected to the Internet. Shodan continuously scans the Internet and exposes its results to users via its website ([_https:// www.shodan.io_](http://www.shodan.io)) and via an API. Attackers can use this tool to identify vulnerable and exposed systems on the Internet (for example, misconfigured IoT devices, infrastructure devices). Penetration testers can use this tool to gather information about potentially vulnerable systems exposed to the Internet without actively scanning their victims. Figure 10-5 shows the results of a Shodan search for Cisco Smart Install client devices exposed to the Internet.

**_Figure 10-5_** _- Shodan_

![[Pasted image 20240620045635.png]]

Example 10-7 shows the Shodan API client. In this example, the client lists high-level statistics for the query **smart install**. In this example, you can see the top 10 countries that have Cisco Smart Install clients exposed to the Internet.

**NOTE** Shodan API’s client libraries can be downloaded from [_https://developer.shodan.io/api/clients_](https://developer.shodan.io/api/clients).

**_Example 10-7_** _-_ _Using the Shodan API Client_

```
omar@kali:~$ shodan stats smart install
Top 10 Results for Facet: country
```

---

**Maltego**

**_Maltego_**, which gathers information from public records, is one of the most popular tools for passive reconnaissance. It supports numerous third-party integrations. There are several versions of Maltego, including a community edition (which is free) and several commercial Maltego client and server options. You can download and obtain more information about Maltego from [_https://www.paterva.com_](https://www.paterva.com). Maltego can be used to find information about companies, individuals, gangs, educational institutions, political movement groups, religious groups, and so on. Maltego organizes query entities within the Entity Palette, and the search options are called “transforms.” Figure 10-6 shows a screenshot of the search results for a Person entity (in this case a search against this book’s coauthor Omar Santos). The results are hierarchical in nature, and you can perform additional queries/searches on the results (entities).

**_Figure 10-6_** _- Maltego Search Results_

![[Pasted image 20240620045908.png]]

In the Maltego Transform Hub, you can select free and commercial products that can be integrated with Maltego. For example, you can integrate Maltego with Shodan or with a website called HaveIBeenPwned that allows you to query whether a person or an email address has been exposed as part of a breach (and potentially gather credentials stolen from such breaches). Dozens of additional tools and commercial products can be integrated with Maltego, as shown in Figure 10-7.

**_Figure 10-7_** _- Maltego’s Transform Hub_

![[Pasted image 20240620050014.png]]

---

**Recon-ng**

**_Recon-ng_** is a menu-based tool that can be used to automate the information gathering of OSINT. Recon-ng comes with Kali Linux and several other penetration testing Linux distributions, and it can be downloaded from [_https://github.com/lanmaster53/recon-ng_](https://github.com/lanmaster53/recon-ng). Figure 10-8 shows the Recon-ng welcome menu.

**_Figure 10-8_** _- Recon-ng_

![[Pasted image 20240620050030.png]]

Recon-ng comes with dozens of modules that can be used to perform detailed searches of public records, interesting files, DNS records, and so on. Example 10-9 includes the output of the **show modules** command in Recon-ng, which lists all the available modules.

**_Example 10-9_** _-_ _Recon-ng Modules_

```
[recon-ng][default] > show modules 
Discovery 
---------      
	discovery/info_disclosure/cache_snoop      
	discovery/info_disclosure/interesting_files 
Exploitation 
------------     
	exploitation/injection/command_injector     
	exploitation/injection/xpath_bruter
```

Recon-ng can query several third-party tools, including Shodan, as well as Twitter, Instagram, Flickr, YouTube, Google, GitHub repositories, and many other sites. For some of those tools and sources, you must register and obtain an API key. You can add the API key by using the Recon-ng **keys add** command. To list all available APIs that Recon-ng can interact with, use the **keys list** command, as demonstrated in Example 10-10.

![[Pasted image 20240620050248.png]]

The **use** command allows you to use a Recon-ng module. After you select the module, you can invoke the **show info** command to display the module options and information. You can then **set** the source (target domain, IP address, email address, and so on) with the **set** command and then use the **run** command to run the automated search. In Example 10-11, the Hostname Resolver module is run to query the web.h4cker.org domain information.

**_Example 10-11_** _-_ _Using Recon-ng Modules_

```
[recon-ng][default] > use recon/hosts-hosts/resolve
[recon-ng][default][resolve] > show info       

Name: Hostname Resolver       
Path: modules/recon/hosts-hosts/resolve.py   
Author: Tim Tomes (@LaNMaSteR53)
```

Example 10-12 shows the Shodan module being used to query for information pertaining to the example.org domain.

**_Example 10-12_** _-_ _Querying Shodan Using Recon-ng_

```
[recon-ng][default] > use recon/domains-hosts/shodan_hostname
[recon-ng][default][shodan_hostname] > set SOURCE example.org
SOURCE => example.org
[recon-ng][default][shodan_hostname] > run
-----------
EXAMPLE.ORG
-----------
[*] Searching Shodan API for: hostname:example.org
[*] [port] 190.106.130.4 (587/<blank>) - host2.example.org
[*] [host] host2.example.org (190.106.130.4)[*] [port] 62.173.139.23 (22/<blank>) - example.org
```

**NOTE** You can learn about all the Recon-ng options and commands at [_https://hackertarget.com/recon-ng-tutorial/_](https://hackertarget.com/recon-ng-tutorial/).

---

**Censys**

**_Censys_**, a tool developed by researchers at the University of Michigan, can be used for passive reconnaissance to find information about devices and networks on the Internet. It can be accessed at [_https://censys.io_](https://censys.io). Censys provides a free web and API access plan that limits the number of queries a user can perform. It also provides several other paid plans that allow for premium support and additional queries. Figure 10-9 shows a screenshot of the Censys website. Figure 10-9 displays the results for a query for 8.8.8.8 (Google’s public DNS server).

**_Figure 10-9_** _- Censys_

![[Pasted image 20240620050630.png]]

**TIP** Module 3 discusses additional tools that can be used for passive reconnaissance. The Art of Hacking GitHub repository also provides numerous other OSINT and passive reconnaissance tools and documentation; see [_https://theartofhacking.org/github_](https://theartofhacking.org/github).

That concludes our discussion of passive reconnaissance tools. Now let's turn our attention to active reconnaissance tools.

---
---

## Tools for Active Reconnaissance

Active reconnaissance involves actively gathering information about a victim by using tools such as port and vulnerability scanners. The following sections describe some of the most popular tools for active reconnaissance.

**Nmap and Zenmap**

Module 3 discusses Nmap in detail, including the most common options and types of scans available in Nmap. The enumeration of hosts is one of the first tasks that needs to be performed in active reconnaissance. Host enumeration could be performed in an internal network and externally (sourced from the Internet). When performed externally, you typically want to limit the IP addresses that you are scanning to just the ones that are part of the scope of the test. Doing so reduces the chances of inadvertently scanning an IP address that you are not authorized to test.

When performing an internal host enumeration, you typically scan the full subnet or subnets of IP addresses being used by the target. Example 10-13 shows a quick Nmap scan being performed to enumerate all hosts in the 10.1.1.0/24 subnet and any TCP ports they may have open. For additional information about the default ports that Nmap scans, see [_https://nmap.org/book/man-port-specification.html_](https://nmap.org/book/man-port-specification.html).

**_Example 10-13_** _-_ _Host Enumeration Using Nmap_

```
nmap -sS <Target>
```

![[Pasted image 20240620050836.png]]

**TIP** Refer to Module 3 for additional information about the most commonly used Nmap options and to learn about the Nmap Scripting Engine (NSE). The Art of Hacking GitHub repository (_[https://theartofhacking.org/github](https://theartofhacking.org/github)_) also has several cheat sheets for different tools, including Nmap.

---

**Enum4linux**

Enum4linux is a great tool for enumerating SMB shares, vulnerable Samba implementations, and corresponding users. Example 10-14 shows the output of a detailed scan using Enum4linux against the host with IP address 10.1.1.14 that was discovered by Nmap in Example 10-13.

**_Example 10-14_** _-_ _Using Enum4linux_

```
root@kali:~# enum4linux -v 10.1.1.14
[V] Dependent program "nmblookup" found in /usr/bin/nmblookup
[V] Dependent program "net" found in /usr/bin/net
```


---

Practice - Common Tools for Reconnaissance and Enumeration

**Q.** You have just started a new engagement with a client in the publishing industry. They have a lot of registered domains and subdomains for their products. You need to investigate their DNS footprint to get a sense of their web-facing attack surface.

Which tools will help you do this? (Choose all that apply.)

**A.** DNS-based tools like nslookup, Host, and Dig can be used to perform passive reconnaissance in order to discover the client's internet footprint.

---
**Q.** During a pentest, you are searching a webserver for files that contain information that you can use in the exploitation phase of the test. You are interested in finding information about your client from exposed file metadata and EXIF information. Which tool would you use to scan the server?

**A.** Fingerprinting Organization with Collected Archives (FOCA) is a tool designed to find metadata and hidden information in documents. It analyzes websites and Microsoft Office, Open Office, PDF, and other documents by extracting file metadata and EXIF (exchangeable image file format) information from files that it discovers through scans of a supplied URL.

---
**Q.** You are conducting passive reconnaissance of a target and would like to find out what servers are registered to the client by querying a range of DNS tools and search engines. 

What tool will you select for this purpose?

**A.** theHarvester is a tool that can enumerate DNS and other information about a given domain name or IP address. It can query several data sources, including Baidu, Google, LinkedIn, public Pretty Good Privacy (PGP) servers, Twitter, vhost, Virus Total, ThreatCrowd, CRT.SH, Netcraft, and Yahoo.

---
**Q.** You are interested in scanning client domains for internet-connected server information, including information from various IoT devices, open ports, server OS, and OS version. 

Which tool can be used to identify vulnerable and exposed systems on the internet as part of a passive reconnaissance activity?

**A.** Shodan is a search engine for devices connected to the internet. It continuously scans the internet and exposes the results to users via the website https://www.shodan.io and via an API. Attackers can use this tool to identify vulnerable and exposed systems on the internet (for example, misconfigured IoT devices and infrastructure devices).

---
**Q.** You are evaluating OSINT tools as part of a reconnaissance effort. Which tool will you use to obtain information about people, companies, and other targets?

**A.** Maltego is a popular tool for passive reconnaissance. It gathers information from public records and supports numerous third-party integrations. Maltego can be used to find information about companies, individuals, gangs, educational institutions, political movement groups, religious groups, and so on.

---
**Q.** Which penetration test tool can perform detailed searches of public records, interesting files, and DNS records?

**A.** Recon-ng is a menu-based tool that can automate OSINT information gathering. It comes with Kali Linux and several other penetration-testing Linux distributions. Recon-ng comes with specific modules that can be used to perform detailed searches of public records, interesting files, DNS records, and so on.

---
**Q.** It is important to know the difference between active and passive reconnaissance tools so that you avoid detection if necessary. Identify whether each reconnaissance tool is passive or active.

**A.** 
![[Pasted image 20240620053005.png]]

---
**Q.** 

**A.** 

---
**Q.** 
 
**A.** 

---
**Q.** 

**A.** 

---
**Q.** 

**A.** 

---
**Q.** 

**A.** 

---
**Q.** 

**A.** 

---
**Q.** 

**A.** 

---
**Q.** 

**A.** 

---
**Q.** 

**A.** 

---
**Q.** 

**A.** 

---
**Q.** 

**A.** 

---
**Q.** 

**A.** 

---
**Q.** 

**A.** 

---
**Q.** 

**A.** 

---
