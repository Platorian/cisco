Two of the most popular exploitation frameworks among pen testers are Metasploit and the Browser Exploitation Framework Project (BeEF).

---

**Metasploit**

**_Metasploit_** is by far the most popular exploitation framework in the industry. It was created by a security researcher named H. D. Moore and then sold to Rapid7. There are two versions of Metasploit: a community (free) edition and a professional edition. Metasploit, which is written in Ruby, has a robust architecture. Metasploit is installed in /usr/share/metasploit-framework by default in Kali Linux. All corresponding files, modules, documentation, and scripts are located in that folder. Example 10-40 shows the location of the Metasploit documentation in Kali.

**_Example 10-40_** _-_ _Metasploit Documentation Location_

```
root@kali:~# ls /usr/share/metasploit-framework/documentation/
CODE_OF_CONDUCT.md CONTRIBUTING.md.gz README.md changelog.Debian.gz
copyright developers_guide.pdf.gz modules
```

Metasploit has several modules:

- auxiliary
- encoders
- exploits
- nops
- payloads
- post (for post-exploitation)

You can launch the Metasploit console by using the **msfconsole** command. When the Metasploit console starts, the banner in Figure 10-25 is displayed.

**_Figure 10-25_** _- The Metasploit Console_

![[Pasted image 20240620093831.png]]

You can use the PostgreSQL database in Kali to accelerate the tasks in Metasploit and index the underlying components. You need to start the PostgreSQL service before using the database by using the following command:

root@kali:~# **service postgresql start**

After starting the PostgreSQL service, you need to create and initialize the Metasploit database with the **msfdb init** command, as shown in Example 10-41.

**_Example 10-41_** _-_ _Initializing the Metasploit Database_

![[Pasted image 20240620094023.png]]

You can search for exploits, auxiliary, and other modules by using the **search** command, as shown in Figure 10-26.

**_Figure 10-26_** _- Searching for Exploits and Other Modules in Metasploit_

![[Pasted image 20240620094102.png]]

Let’s take a look at how to use an exploit against a vulnerable Linux server. Example 10-42 shows an exploit against a vulnerable IRC server (10.1.1.14) that is conducted with the **use exploit/unix/irc/unreal_ircd_3281_backdoor** command. The remote host (RHOST), 10.1.1.14, is set, and the exploit is launched using the **exploit** command.

**_Example 10-42_** _-_ _Launching an Exploit in Metasploit_

![[Pasted image 20240620094153.png]]

In Example 10-42, you can see that the exploit is successful and that a command shell session was opened (in the first highlighted line). The Linux **id** command is issued (second highlighted line), and you can see that the shell in the compromised system is running as root. It is then possible to start gathering additional information from the compromised system. The third highlighted line in Example 10-42 shows the **cat/etc/shadow** command used to retrieve the user password hashes from the compromised system. It is then possible to crack those passwords offline or, better yet, while running as root, to create new users in the compromised systems.

**TIP** A free and detailed Metasploit training course can be obtained from _[https://www.offensive-security.com/metasploit-unleashed](https://www.offensive-security.com/metasploit-unleashed)_. This course goes over each and every option in Metasploit and its architecture. I recommend you navigate throughout the options and become familiar with other modules, such as msfvenom, msf-pattern_create, msf-pattern_offset, and msf-metasm_shell.

Let’s take a look at a brief example of how Meterpreter can be used for post-exploitation activities. 

Select each of the following steps for an example of Metasploit being used to exploit the EternalBlue (MS17-010) vulnerability in Windows.

**NOTE** To read a Microsoft security bulletin addressing this vulnerability, visit [_https://docs.microsoft.com/en-us/security-updates/securitybulletins/2017/ms17-010_](https://docs.microsoft.com/en-us/security-updates/securitybulletins/2017/ms17-010).

---

**Step 1. Create a bind TCP connection**

Figure 10-27 shows the Meterpreter payload for a bind TCP connection (after exploitation) being set.

**_Figure 10-27_** _- Using Meterpreter to Create a Bind TCP Connection After Exploitation_

![[Pasted image 20240620094650.png]]

**Step 2. Execute the exploit**

Figure 10-28 shows the exploit executed and a Meterpreter session now active.

**_Figure 10-28_** _- Exploiting a Vulnerability and Establishing a Meterpreter Session_

![[Pasted image 20240620094703.png]]

**Step 3. View List of Commands - Part 1**

Meterpreter allows you to execute several commands to get information from the compromised system and send other administrative commands, as shown in Figure 10-29, part 1

**_Figure 10-29_** _- Meterpreter Commands, Part 1_

![[Pasted image 20240620094717.png]]

**Step 3. View List of Commands - Part 2**

More Meterpreter commands are shown in Figure 10-30, part 2

**_Figure 10-30_** _- Meterpreter Commands, Part 2_

![[Pasted image 20240620094754.png]]

**Step 4. Get all password hashes**

Figure 10-31 shows the **hashdump** Meterpreter command being used to dump all the password hashes from the compromised system.

**_Figure 10-31_** _- The hashdump Meterpreter Command_

![[Pasted image 20240620094818.png]]

**Step 5. Obtain additional information**

Figure 10-32 shows the **getsystem** and **sysinfo** Meterpreter commands being used to obtain additional information from the compromised system. The **screenshot** command is used to collect a screenshot of the current desktop screen in the compromised system (which shows what the legitimate user is doing). The screenshot is saved in a file (/root/cXevElcg.jpeg) in the attacking system.

**_Figure 10-32_** _- Getting System Information and Collecting a Screenshot of the Victim System’s Desktop_

![[Pasted image 20240620094836.png]]

---
---

**BeEF**

BeEF is an exploitation framework for web application testing. BeEF exploits browser vulnerabilities and interacts with one or more web browsers to launch directed command modules. Each browser can be configured in a different security context. BeEF allows you to launch a set of unique attack vectors and select specific modules in real time to target each browser and context.

You can download BeEF and obtain its documentation from [_https://beefproject.com_](https://beefproject.com).

BeEF contains numerous command modules and uses a robust API that allows security professionals to quickly develop custom modules. Figure 10-33 shows a screenshot of BeEF in Kali Linux.

**_Figure 10-33_** _- BeEF_

![[Pasted image 20240620095503.png]]

---

### Practice - Exploitation Frameworks

**Q.** You want to exploit user browsers as a way to attack the Pixel Paradise web applications.

Which exploitation framework exploits client browser vulnerabilities to conduct web application attacks?

**A.** Browser Exploitation Framework, or BeEF, is an exploitation framework for web application testing. It exploits browser vulnerabilities and interacts with web clients to launch directed command modules to compromise web applications. Each browser can be configured in a different security context. It allows a set of unique attack vectors and specific modules to be launched in real-time to target each browser and context.

**Q.** Which exploitation framework has a vast array of functions including creating payloads and exploiting numerous vulnerabilities for command and control?

**A.** Metasploit is a collection of tools and modules that have many capabilities. For example, Metasploit can be used to exploit numerous vulnerabilities for command and control and to create various types of payloads. There are two versions of Metasploit: a community (free) edition and a professional edition. It is written in Ruby and has a robust architecture.




