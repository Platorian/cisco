This topic discusses a variety of network-based vulnerabilities and exploits.

**NetBIOS Name Service and LLMNR**

Network Basic Input/Output System (NetBIOS) and Link-Local Multicast Name Resolution (LLMNR) are protocols primarily used by Microsoft Windows for host identification. LLMNR is based on the Domain Name System (DNS) protocol format. NetBIOS provides three services: Name Service (NetBIOS-NS), Datagram Service (NetBIOS-DGM), and Session Service (NetBIOS-SSN). These operations use specific TCP and UDP ports for communication. Windows workgroups are LAN peer-to-peer networks, while domain-based implementations are client-to-server networks supporting numerous hosts across multiple subnets.

Historically, there have been many vulnerabilities in NetBIOS, SMB, and LLMNR. A common LLMNR vulnerability involves an attacker spoofing an authoritative source for name resolution, poisoning the LLMNR service, and obtaining the victim's username and NTLMv2 hash. Tools like NBNSpoof, Metasploit, and Responder can be used to conduct these attacks. Pupy, an open-source Python-based cross-platform remote administration tool, is also popular among penetration testers and attackers.

**SMB Exploits**

The topic discusses SMB's history of vulnerabilities and highlights the notorious EternalBlue exploit. Leaked by the Shadow Brokers, this exploit has been used in ransomware like WannaCry and Nyeta. Metasploit is one tool that has ported the EternalBlue exploit. Example 5-2 demonstrates how to use the exploit in Metasploit, requiring the configuration of RHOST and LHOST IP addresses. Once executed, Metasploit launches a Meterpreter session for further system control and compromise. Enumeration is an essential aspect of penetration testing, and tools like Nmap and Enum4linux can gather information on vulnerable SMB systems, which can then be exploited using Metasploit.

**DNS Cache Poisoning**

DNS cache poisoning is an attack in which threat actors manipulate the DNS resolver cache by injecting corrupted data. This forces the DNS server to send the wrong IP address to the victim, redirecting them to the attacker's system. The process involves the following steps:

1. The attacker corrupts the DNS server cache to impersonate a website.
2. After the attack, the DNS server resolves the website to the attacker's IP address instead of the correct one.
3. The victim requests the IP address of the domain from the DNS server.
4. The DNS server replies with the attacker's IP address.
5. The victim sends an HTTP GET request to the attacker's system, and the attacker impersonates the domain.

DNS cache poisoning attacks may also use social engineering tactics to trick victims into downloading malware or entering sensitive data into spoofed forms and applications.

**SNMP Exploits**

SNMP is a protocol used to manage network devices, with each device containing an SNMP agent that connects to an SNMP server. Administrators can use SNMP to obtain information, change configurations, and perform other tasks. There are multiple versions, with SNMPv2c and SNMPv3 being the most popular. SNMPv2c uses community strings as passwords, while SNMPv3 is more secure with usernames and passwords. However, both versions are susceptible to attacks if weak or default credentials are used.

The Nmap scanner, along with its NSE scripts, can be used to gather information from SNMP-enabled devices and brute-force weak credentials. Additionally, the **snmp-check** tool can be utilized to perform an SNMP walk for gathering device information.

**SMTP Exploits**

Insecure SMTP servers can be exploited to send spam and conduct phishing and other email-based attacks. SMTP open relay is an email server configuration that can be abused for such purposes. Nmap provides an NSE script to test for open relay configurations. Useful SMTP commands, such as HELO, EHLO, and VRFY, can be used to evaluate an email server's security. The **smtp-user-enum** tool in Kali Linux automates information gathering. Disabling VRFY and EXPN commands on modern email servers and using firewalls to block SMTP connections with these commands can improve security. Known SMTP server exploits can be found using the **searchsploit** command.

**FTP Exploits**

FTP servers are often abused by attackers to steal information, as the legacy FTP protocol lacks encryption and integrity validation. To enhance security, it is recommended to use FTPS or SFTP. These protocols use encryption, but some implementations have weak encryption ciphers like Blowfish and DES. It is advised to use stronger algorithms such as AES. SFTP and FTPS servers also use hashing algorithms for verifying file transmission integrity. Best practices include disabling weak hashing protocols like MD5 or SHA-1 and using stronger algorithms in the SHA-2 family.

FTP servers might enable anonymous user authentication, which can be exploited by attackers. To mitigate this, disable anonymous login in the server configuration file. Additional best practices include using strong passwords and multifactor authentication, implementing file and folder security, encrypting files stored on the server, locking down administration accounts, keeping server software up-to-date, using FIPS 140-2 validated encryption ciphers, storing back-end databases on separate servers, and requiring re-authentication for inactive sessions.

**Pass-the-Hash Attacks**

Pass-the-hash attacks exploit the storage of password hashes in Windows' Security Accounts Manager (SAM) file. Attackers use collected password hashes from compromised systems to log in to other systems without knowing the actual password. This bypasses the usual password-entry and conversion process.

**Kerberos and LDAP-Based Attacks**

Kerberos is an authentication protocol used by Windows and many applications and operating systems. Active Directory uses LDAP as an access protocol, which supports Kerberos authentication. Common attacks include Kerberos golden ticket and silver ticket attacks, where attackers manipulate Kerberos tickets based on available hashes. Unconstrained Kerberos delegation is another weakness, which allows applications to reuse end-user credentials to access resources hosted on different servers.

**Kerberoasting**

Kerberoasting is an attack that extracts service account credential hashes from Active Directory for offline cracking. It exploits weak encryption implementations and improper password practices.

**On-Path Attacks**

On-path attacks involve an attacker intercepting communication between two devices or individuals to steal or manipulate data. These can happen at Layer 2 or Layer 3. ARP spoofing, MAC spoofing, and manipulating Spanning Tree Protocol (STP) are examples of on-path attacks. To secure infrastructure, follow Layer 2 security best practices such as selecting an unused VLAN, configuring switch ports as access ports, limiting the number of MAC addresses learned on a port, controlling Spanning Tree, turning off Cisco Discovery Protocol (CDP) on untrusted ports, shutting down all ports on a new switch, using Root Guard, implementing 802.1X when possible, and deploying access control lists (ACLs).

In downgrade attacks, attackers force a system to use a weaker encryption protocol or hashing algorithm that is susceptible to vulnerabilities. The Padding Oracle on Downgraded Legacy Encryption (POODLE) vulnerability in OpenSSL is an example of a downgrade attack. To prevent such attacks, removing backward compatibility is often the only solution.

**Route Manipulation Attacks**

One common route manipulation attack is BGP hijacking. In this attack, a threat actor configures or compromises an edge router to announce unauthorized prefixes. This can redirect the victim's traffic to the attacker if the malicious route is more specific or shorter than the legitimate one. Attackers sometimes use unused prefixes to avoid attention from the legitimate user or organization.

**DoS and DDoS Attacks**

DoS and DDoS attacks aim to overwhelm a target with an excessive amount of traffic or exploit vulnerabilities to crash systems. There are three categories of DoS attacks: direct, reflected, and amplification.

- **Direct DoS Attacks**: The attacker sends packets directly to the victim, flooding their connection bandwidth or depleting their system resources. SYN flood attacks are an example of direct DoS attacks.
- **Reflected DoS and DDoS Attacks**: Attackers send spoofed packets to sources that appear to be from the victim, making the sources unwitting participants in the attack. UDP is often used as the transport mechanism in these attacks due to the lack of a three-way handshake.
- **Amplification DDoS Attacks**: A type of reflected DoS attack where the response traffic is much larger than the initial packets sent by the attacker. An example is sending DNS queries to an open resolver, which replies with larger responses, flooding the victim's machine.

**Network Access Control (NAC) Bypass**

NAC interrogates endpoints before joining a wired or wireless network, enforcing policies like checking for security software, operating system versions, and patching. Attackers can bypass NAC by spoofing authorized MAC addresses, enabling them to connect to the network.

**VLAN Hopping**

VLAN hopping is a method of gaining access to traffic on other VLANs that would normally be inaccessible. Two primary methods of VLAN hopping exist: switch spoofing and double tagging. Switch spoofing involves imitating a trunking switch by sending the respective VLAN tag and trunking protocols. Double tagging adds two VLAN tags to a frame, with most switches removing only the outer tag, enabling the attacker to access the victim's VLAN.

**DHCP Starvation Attacks and Rogue DHCP Servers**

DHCP starvation attacks involve broadcasting numerous fake DHCP REQUEST messages with spoofed MAC addresses, depleting available IP addresses in the DHCP server scope. With no available IP addresses, the attacker can set up a rogue DHCP server and respond to new DHCP requests, intercepting traffic from network hosts.