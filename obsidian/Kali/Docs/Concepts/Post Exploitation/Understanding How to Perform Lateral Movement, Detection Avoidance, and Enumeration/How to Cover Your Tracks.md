After compromising a system during a penetration testing engagement, you should always cover your tracks to avoid detection by suppressing logs (when possible), deleting user accounts that could have been created on the system, and deleting any files that were created. In addition, after a penetration testing engagement is complete, you should clean up all systems. As a best practice, you should discuss these tasks and document them in the rules of engagement document during the pre-engagement phase. The following are a few best practices to keep in mind during the cleanup process:

- Delete all user accounts used during the test.
- Delete all files, executable binaries, scripts, and temporary files from compromised systems. A secure deletion method may be preferred. NIST Special Publication 800-88, Revision 1: “Guidelines for Media Sanitization,” provides guidance for media sanitation. This methodology should be discussed with your client and the owner of the affected systems.
- Return any modified systems and their configuration to their original values and parameters.
- Remove all backdoors, daemons, services, and rootkits installed.
- Remove all customer data from your systems, including attacking systems and any other support systems. Typically, you should do this after creating and delivering the penetration testing report to the client.

**Steganography**

Attackers can use steganography for obfuscation, evasion, and to cover their tracks. **_Steganography_** involves hiding a message or any other content inside an image or a video file. To accomplish this task, you can use tools such as **steghide**. You can easily install this tool in a Debian-based Linux system by using the command **sudo apt install steghide**. Example 8-10 shows the **steghide** command usage and help information.

**_Example 8-10_** _-_ **_steghide_** _Command Usage_

```
|--[omar@websploit]-[~]
|---- $steghide --help
steghide version 0.5.1
the first argument must be one of the following: 
embed, --embed             embed data 
extract, --extract        extract data 
info, --info                display information about a cover- 
or                               
stego-file   
info <filename>          display information about <filename> 
encinfo, --encinfo        display a list of supported encryption                               algorithms 
version, --version        display version information 
license, --license        display steghide’s license 
help, --help               display this usage information
embedding options: 
-ef, --embedfile          select file to be embedded   -ef <filename>          embed the file <filename> 
-cf, --coverfile          select cover-file   -cf <filename>          embed into the file <filename> 
-p, --passphrase          specify passphrase   
-p <passphrase>         use <passphrase> to embed data 
-sf, --stegofile          select stego file   -sf <filename>          write result to <filename> instead of                              cover-file 
-e, --encryption          select encryption parameters   
-e <a>[<m>]|<m>[<a>]   specify an encryption algorithm and/
or mode   
-
e none                   do not encrypt data before embedding 
-z, --compress            compress data before embedding (default)   -z <l>                    using level <l> (1 best speed...9 best                              compression) 
-Z, --dontcompress        do not compress data before embedding 
-K, --nochecksum          do not embed crc32 checksum of embedded data 
-N, --dontembedname       do not embed the name of the original file 
-f, --force                 overwrite existing files 
-q, --quiet                 suppress information messages 
-v, --verbose              display detailed informationextracting options: 
-sf, --stegofile          select stego file   -sf <filename>          extract data from <filename> 
-p, --passphrase          specify passphrase   
-p <passphrase>         use <passphrase> to extract data 
-xf, --extractfile        select file name for extracted data   
-xf <filename>           write the extracted data to <filename> 
-f, --force                overwrite existing files 
-q, --quiet                suppress information messages 
-v, --verbose              display detailed informationoptions for the info command: 
-p, --passphrase          specify passphrase   
-p <passphrase>         use <passphrase> to get info about                              embedded data
To embed emb.txt in cvr.jpg: steghide embed -cf cvr.jpg -
ef emb.txt
To extract embedded data from stg.jpg: steghide extract -
sf stg.jpg|--[omar@websploit]-[~]|---- $
```

Let’s take a look at an example of how to embed sensitive information and hide a message within an image file by using steganography. In Example 8-11, a file called secret.txt includes sensitive information (credit card data) that will be exfiltrated using steganography.

**_Example 8-11_** _-_ _Sensitive Data to Be Hidden Using Steganography_

```
|--[omar@websploit]-[~]
|---- $cat secret.txt
Credit card data:4011 5555 5555 5555 5555 exp 08/29 ccv: 123
4021 6666 7777 8888 9999 exp 02/29 ccv: 321

|--[omar@websploit]-[~]
|---- $ 
```

Example 8-12 shows how to embed this sensitive data (secret.txt) into an image file (websploit-logo.png) by using **steghide**.

**_Example 8-12_** _-_ _Using_ **_steghide_** _to Hide Sensitive Data in an Image File_

```
|--[omar@websploit]-[~]
|---- $steghide embed -ef secret.txt -cf websploit-logo.jpg
Enter passphrase: this-is-a-passphrase
Re-Enter passphrase: this-is-a-passphrase
embedding "secret.txt" in "websploit-logo.jpg"... done
|--[omar@websploit]-[~]
|---- $ 
```

Example 8-13 shows how the sensitive data is retrieved from the image and saved in a file (**extracted_data.txt**).

**_Example 8-13_** _-_ _Extracting Hidden Data from an Image File_

```
|--[omar@websploit] ⊠[~]
|---- $steghide extract -sf websploit-logo.jpg -xf extracted_data.txt
Enter passphrase: this-is-a-passphrase
wrote extracted data to "extracted_data.txt".
```

Example 8-14 shows the contents of the extracted data file (extracted_data.txt).

**_Example 8-14_** _-_ _The Contents of the Extracted Data File_

```
|--[omar@websploit]-[~]
|---- $cat extracted_data.txt
Credit card data:
4011 5555 5555 5555 5555 exp 08/29 ccv: 123
4021 6666 7777 8888 9999 exp 02/29 ccv: 321
|--[omar@websploit]-[~]
|----$
```


---

Practice - Steganography

You are investigating a means of exfiltrating a non-sensitve file that you have discovered on a protected Pixel Paradise server that you have be able to gain access to. This would demonstrate that undetected exfiltration is possible with the current security posture of the company.

You are looking at potentially hiding the text of the document file in a screen grab image of one of their games. Which tool can use to create the screen grab file?

Steghide is a steganography tool. Attackers can use it for obfuscation and evasion and to cover the attackers' tracks, including clandestinely exfiltrating data. Steganography involves hiding a message or any other content inside various types of files including images and videos.