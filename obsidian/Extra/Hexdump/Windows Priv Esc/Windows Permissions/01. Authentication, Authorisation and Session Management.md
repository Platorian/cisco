## Authentication, Authorisation and Session Management

Anytime we interact with a secure digital system that has different permission roles, we will always have to deal with the following three aspects:

- **Authentication:** who are you?
- **Authorisation:** what can you do
- **Session Management:** how is the information regarding the identity of the user stored and processed while the user is using an authenticated session?

## Security Principals and Security Identifier (SID)

**Security principles** can represent any entity that can be authenticated by the operating system.

A security identifier is used to uniquely identify a security principle or security group.

**SID** -> Security Identifier.

Examples of security principles:
- user account
- computer account (service accounts)
- thread or process

The **SID** cannot be changed and is generated upon the user or groups creation.

**SIDs** are generated by different components depending on the situation:

- The **SID** for local accounts and groups is generated by the **Local Security Authority (LSA)**.
- The **SID** for domain users and domain groups is generated by the **Domain Controller (DC)**.

**SIDs** are used by windows to identify security principles for access control management (authorisation management).

## SID Structure

The SID is made up of different parts.

Example:
> S-R-X-Y1-Yn-1-Yn

Where:
- **S** - indicates that the string is a SID.
- **R** - indicates the **revision** of the SID structure that is used. Typically it has a value of 1.
- **X** - determines the **identifier authority** that issued the SID.
- **Y** - determines the **subauthorities**. 

All values up to, but not including, the last value in the series collectively identify a domain in an enterprise. This part of the series is called **domain identifier**.

The last value in the series, which is called the **relative identifier (RID)**, identifies a particular account or group relative to a domain.

The SID's most important information is contained in the series of subauthority values. The first part of the series (-Y1-Y2-Yn-1) is the domain identifier.

No two domains in an enterprise share the same domain identifier.

The last item in the series of subauthority  values (-Yn) is the relative identifier. It distinguishes one account or group from all other accounts and groups in the domain.

No two accounts or groups in any domain share the same relative identifier.

Consider the following SID

Example:
> S-1-5-32-544

This SID has four components:
- A revision level (1)
- An identifier authority value (5, NT Authority)
- A domain identifier (32, Builtin)
- A relative identifier (544, Administrators)

Consider another SID

Example:
> S-1-5-21-1004336348-1177238915-682003330-512

The SID for Contoso\Domain Admins has:
- A revision level (1)
- An identifier (5, NT Authority)
- A domain identifier (1-1004336348-1177238915-682003330, Contoso)
- A releavtive identifier (512, Domain Admins)

The SID for Contoso\Domain Admins is distinguished from the SIDs for other Domain Admins groups in the same enterprise by its domain identifier:

Example:
> 21-1004336348-1177238915-682003330

The SID for Contoso\Domain Admins is distinguished from the SIDs for other accounts and groups that are created in the Contoso domain by it's relative identifier

Example:
> 512

## Well Known SIDs

The value of certain SIDs are constant across all systems.

They're created when the operating system or domain is installed. They're called **well-known-SIDs** because they identify generic users or generic groups.

There are universal well-known  that are meaningful on all secure systems that use this security model, including operating systems other than Windows.

In addition, there are well-known SIDs that are meaningful only on Windows operating systems.

## Enumerating SIDs

Obtain the SID for the current logged in user
```cmd
whoami /user
```

We can enumerate the SIDs with the `wmic` command
```cmd
wmic useraccount get domain, name, sid
```

##  Access Token






















